<section xmlns="http://www.w3.org/1999/xhtml" xmlns:gale="http://gale.tue.nl/adaptation">

    <p>Welcome to the sorting ceremony of Hogwarts School of WitchCraft And Wizardry!</p>

    <gale:if expr="${#sorting-test-active} == true">
        <gale:then>

            <p>
                As we are sure that most of you know, the sorting hat determines what house you belong to. Once you are
                assigned
                a house, your house will be like your family. You will sleep with your house, points will be assigned to
                each
                house
                and at the end, each house has the opportunity of winning the house cup!
            </p>

            <form id="sorting-test" method="post">

                <gale:attr-variable name="action" expr="gale.req().getRequestURL()+&quot;?plugin=form&quot;"/>

                <p> What is your favorite color</p>

                <input id="favourite-color-1" type="radio" name="favourite-color" value="1"/><label
                    for="favourite-color-1">Red</label>
                <input id="favourite-color-2" type="radio" name="favourite-color" value="2"/><label
                    for="favourite-color-2">Blue</label>
                <input id="favourite-color-3" type="radio" name="favourite-color" value="3"/><label
                    for="favourite-color-3">Green</label>
                <input id="favourite-color-4" type="radio" name="favourite-color" value="4"/><label
                    for="favourite-color-4">Yellow</label>

                <p> What do you do if you don't know something?</p>

                <input id="do-not-know-1" type="radio" name="do-not-know" value="1"/>
                <label for="do-not-know-1">Keep trying until it works</label>
                <input id="do-not-know-2" type="radio" name="do-not-know" value="2"/>
                <label for="do-not-know-2">Research it until you know</label>
                <input id="do-not-know-3" type="radio" name="do-not-know" value="3"/>
                <label for="do-not-know-3">Reason about it with logic</label>
                <input id="do-not-know-4" type="radio" name="do-not-know" value="4"/>
                <label for="do-not-know-4">Ask someone else to explain</label>

                <p> What is your favorite course</p>

                <input id="favourite-course-1" type="radio" name="favourite-course" value="1"/>
                <label for="favourite-course-1">Defense Against the Dark Arts</label>
                <input id="favourite-course-2" type="radio" name="favourite-course" value="2"/>
                <label for="favourite-course-2">Spells and Charms</label>
                <input id="favourite-course-3" type="radio" name="favourite-course" value="3"/>
                <label for="favourite-course-3">Potions</label>
                <input id="favourite-course-4" type="radio" name="favourite-course" value="4"/>
                <label for="favourite-course-4">Herbology</label>

                <p> What is your favorite creature</p>

                <input id="favourite-creature-1" type="radio" name="favourite-creature" value="1"/>
                <label for="favourite-creature-1">Hippogriff</label>
                <input id="favourite-creature-2" type="radio" name="favourite-creature" value="2"/>
                <label for="favourite-creature-2">Flubber-Bookworm</label>
                <input id="favourite-creature-3" type="radio" name="favourite-creature" value="3"/>
                <label for="favourite-creature-3">Two-headed Sea Snake</label>
                <input id="favourite-creature-4" type="radio" name="favourite-creature" value="4"/>
                <label for="favourite-creature-4">Tree troll</label>

                <p> What is your favorite book</p>

                <input id="favourite-book-1" type="radio" name="favourite-book" value="1"/>
                <label for="favourite-book-1">The amazing adventures of the great mystic knight</label>
                <input id="favourite-book-2" type="radio" name="favourite-book" value="2"/>
                <label for="favourite-book-2">A profound theory of magic through the ages</label>
                <input id="favourite-book-3" type="radio" name="favourite-book" value="3"/>
                <label for="favourite-book-3">How to proceed with power</label>
                <input id="favourite-book-4" type="radio" name="favourite-book" value="4"/>
                <label for="favourite-book-4">Something with a lot of pictures</label>

                <p> What is your favorite pet</p>

                <input id="favourite-pet-1" type="radio" name="favourite-pet" value="1"/>
                <label for="favourite-pet-1">Owl</label>
                <input id="favourite-pet-2" type="radio" name="favourite-pet" value="2"/>
                <label for="favourite-pet-2">Cat</label>
                <input id="favourite-pet-3" type="radio" name="favourite-pet" value="3"/>
                <label for="favourite-pet-3">Rat</label>
                <input id="favourite-pet-4" type="radio" name="favourite-pet" value="4"/>
                <label for="favourite-pet-4">Frog</label>

                <p> What is your favorite relaxing activity</p>

                <input id="favourite-relaxing-1" type="radio" name="favourite-relaxing" value="1"/>
                <label for="favourite-relaxing-1">Quidditch</label>
                <input id="favourite-relaxing-2" type="radio" name="favourite-relaxing" value="2"/>
                <label for="favourite-relaxing-2">Reading</label>
                <input id="favourite-relaxing-3" type="radio" name="favourite-relaxing" value="3"/>
                <label for="favourite-relaxing-3">Duelling</label>
                <input id="favourite-relaxing-4" type="radio" name="favourite-relaxing" value="4"/>
                <label for="favourite-relaxing-4">Games</label>

                <p> What is your favorite place on Hogwarts</p>

                <input id="favourite-place-1" type="radio" name="favourite-place" value="1"/>
                <label for="favourite-place-1">Dormitory</label>
                <input id="favourite-place-2" type="radio" name="favourite-place" value="2"/>
                <label for="favourite-place-2">Library</label>
                <input id="favourite-place-3" type="radio" name="favourite-place" value="3"/>
                <label for="favourite-place-3">Basement</label>
                <input id="favourite-place-4" type="radio" name="favourite-place" value="4"/>
                <label for="favourite-place-4">3houses</label>

                <p> What is your favorite pick-up line?</p>

                <input id="favourite-pickup-1" type="radio" name="favourite-pickup" value="1"/>
                <label for="favourite-pickup-1">I solemnly swear I am up to no good</label>
                <input id="favourite-pickup-2" type="radio" name="favourite-pickup" value="2"/>
                <label for="favourite-pickup-2">Smart is the new sexy</label>
                <input id="favourite-pickup-3" type="radio" name="favourite-pickup" value="3"/>
                <label for="favourite-pickup-3">Let me slither in your bed</label>
                <input id="favourite-pickup-4" type="radio" name="favourite-pickup" value="4"/>
                <label for="favourite-pickup-4">You're pretty...</label>

                <p> What is your favorite country for holidays</p>

                <input id="favourite-country-1" type="radio" name="favourite-country" value="1"/>
                <label for="favourite-country-1">Romania</label>
                <input id="favourite-country-2" type="radio" name="favourite-country" value="2"/>
                <label for="favourite-country-2">Bulgaria</label>
                <input id="favourite-country-3" type="radio" name="favourite-country" value="3"/>
                <label for="favourite-country-3">Greece</label>
                <input id="favourite-country-4" type="radio" name="favourite-country" value="4"/>
                <label for="favourite-country-4">England</label>


                <a href="#" class="button sorting-button"
                   onclick="document.forms['sorting-test'].submit(); return false">
                    I'm sure of my selection
                </a>

                <input name="exec" type="hidden" value="
            int[] results = new int[] {
                Integer.parseInt(gale.req().getParameter(&quot;favourite-color&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;do-not-know&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-course&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-creature&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-book&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-pet&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-relaxing&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-place&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-pickup&quot;)),
                Integer.parseInt(gale.req().getParameter(&quot;favourite-country&quot;))
            };

            int gryffindorCount = 0;
            int ravenclawCount = 0;
            int slytherinCount = 0;
            int hufflepuffCount = 0;

            for (int i = 0; i &lt; results.length; i++) {
                if(results[i] == 1) gryffindorCount++;
                if(results[i] == 2) ravenclawCount++;
                if(results[i] == 3) slytherinCount++;
                if(results[i] == 4) hufflepuffCount++;
            }

            if(gryffindorCount >= ravenclawCount &amp;&amp; gryffindorCount >= slytherinCount &amp;&amp; gryffindorCount >= hufflepuffCount){
                ${_concept->(personal)#user-house} = &quot;gryffindor&quot;;
            }
            else if(ravenclawCount >= gryffindorCount &amp;&amp; ravenclawCount >= slytherinCount &amp;&amp; ravenclawCount >= hufflepuffCount){
                ${_concept->(personal)#user-house} = &quot;ravenclaw&quot;;
            }
            else if(slytherinCount >= gryffindorCount &amp;&amp; slytherinCount >= ravenclawCount &amp;&amp; slytherinCount >= hufflepuffCount){
                ${_concept->(personal)#user-house} = &quot;slytherin&quot;;
            }
            else {
                ${_concept->(personal)#user-house} = &quot;hufflepuff&quot;;
            }

            ${#sorting-test-active} = false;
							"/>
                <input name="redirect" type="hidden">
                    <gale:attr-variable name="value" expr="${.}.getUriString()"/>
                </input>
            </form>

        </gale:then>
        <gale:else>

            <gale:text type="creole" tag="default">
                Congratulations for being sorted into
                <gale:variable expr="${_concept->(personal)#user-house}"/>
                house!
                You're a fully fledged member now and can proceed directly to learn everything to do with magic spells,
                potions and more at [[../school|school]] with your amazing new family!
            </gale:text>

            <gale:if expr="${#sorted-adaptively}">
                <gale:then>
                    <gale:if expr="&quot;ravenclaw&quot;.equals(${_concept->(personal)#user-house})">
                        <p>
                            We sorted you into this house because you have read a staggering
                            <gale:variable
                                    expr="CountModule.getVisitedUriCache(${../../hogwarts}.getUri(), gale).length"/>
                            different pages since you got here. That's a lot of thirst for knowledge and as such you
                            really
                            are a true Ravenclaw!
                        </p>
                    </gale:if>
                    <gale:if expr="&quot;hufflepuff&quot;.equals(${_concept->(personal)#user-house})">
                        <p>
                            It's ok, we get it, we really do, you don't like to read to much and instead focus on
                            caring for those around you. That's definitely something to not be ashamed of!
                            We must however say that we sorted you into Hufflepuff House because you have only read
                            <gale:variable
                                    expr="CountModule.getVisitedUriCache(${../../hogwarts}.getUri(), gale).length"/>
                            different pages since you got here.
                        </p>
                    </gale:if>
                </gale:then>
            </gale:if>

            <div>
                If you aren't happy with your results or would like to try to be sorted again, then you can do so by
                clicking

                <form id="try-again" method="post">
                    <gale:attr-variable name="action" expr="gale.req().getRequestURL()+&quot;?plugin=form&quot;"/>
                    <a href="#" onclick="document.forms['try-again'].submit(); return false">here</a>.
                    <input name="exec" type="hidden" value="${#sorting-test-active} = true;"/>
                    <input name="redirect" type="hidden" value="true">
                        <gale:attr-variable name="value" expr="${.}.getUriString()"/>
                    </input>
                </form>

                Note that your current house won't be changed until after you have done the test.

            </div>

        </gale:else>
    </gale:if>

</section>